<div class="gl-plot plot-legend-{{legend.get('position')}} {{legend.get('expanded')? 'plot-legend-expanded' : 'plot-legend-collapsed'}}">
    <div class="gl-plot-legend flex-elem l-flex-row"
         ng-class="{ 'hover-on-plot': !!highlights.length }"
         ng-show="legend.get('position') !== 'hidden'">
        <span class="view-control flex-elem"
            ng-class="{ expanded: legend.get('expanded') }"
            ng-click="legend.set('expanded', !legend.get('expanded'));">
        </span>

        <!-- COLLAPSED PLOT LEGEND -->
        <div class="plot-wrapper-collapsed-legend">
            <div class="plot-legend-item"
                  ng-repeat="series in series track by $index">
                <div class="plot-series-swatch-and-name">
                    <span class="plot-series-color-swatch"
                          ng-style="{ 'background-color': series.get('color').asHexString() }">
                    </span>
                    <span class="plot-series-name">{{ series.get('name') }}</span>
                </div>
                <div class="plot-series-value hover-value-enabled value-to-display-{{ legend.get('valueToShowWhenCollapsed') }}"
                     ng-class="{ 'cursor-hover': (legend.get('valueToShowWhenCollapsed').indexOf('nearest') != -1) }"
                     ng-show="!!highlights.length && legend.get('valueToShowWhenCollapsed') !== 'none'">
                    {{ legend.get('valueToShowWhenCollapsed') === 'nearestValue' ?
                        series.format(series.closest, yAxis.get('key')) :
                        legend.get('valueToShowWhenCollapsed') === 'nearestTimestamp' ?
                             series.closest && series.format(series.closest, xAxis.get('key')) :
                             series.format(series.stats.get(yAxis.get('key'))[legend.get('valueToShowWhenCollapsed')], yAxis.get('key'));
                    }}
                </div>
            </div>
        </div>

        <!-- EXPANDED PLOT LEGEND -->
        <div class="plot-wrapper-expanded-legend flex-elem grows">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th ng-repeat="name in legend.get('valuesToShowWhenExpanded')"
                            ng-class="{ 'mobile-hide': name.indexOf('nearest') != -1 }">
                            {{ legend.get('niceValuesToShowWhenExpanded')[name] }}
                        </th>
                    </tr>
                </thead>
                <tr ng-repeat="series in series" class="plot-legend-item">
                    <td class="plot-series-swatch-and-name">
                        <span class="plot-series-color-swatch"
                              ng-style="{ 'background-color': series.get('color').asHexString() }">
                        </span>
                        <span class="plot-series-name">{{ series.get('name') }}</span>
                    </td>
                    <td ng-repeat="name in legend.get('valuesToShowWhenExpanded')"
                        ng-class="{ 'mobile-hide': name.indexOf('nearest') != -1 }">
                        <span class="plot-series-value {{ (name.indexOf('nearest') != -1)? 'cursor-hover hover-value-enabled' : '' }}">
                              {{ name === 'nearestValue' ?
                            series.format(series.closest, yAxis.get('key')) :
                            name === 'nearestTimestamp' ?
                                 series.closest && series.format(series.closest, xAxis.get('key')) :
                                 series.format(series.stats.get(yAxis.get('key'))[name], yAxis.get('key'));
                        }}
                        </span>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="plot-wrapper-axis-and-display-area flex-elem grows">
        <div class="gl-plot-axis-area gl-plot-y"
             ng-style="{
                 width: (tickWidth + 30) + 'px'
             }">

            <div class="gl-plot-label gl-plot-y-label">
                {{ yAxis.get('label') }}
            </div>

            <mct-ticks axis="yAxis">
                <div ng-repeat="tick in ticks track by tick.text"
                     class="gl-plot-tick gl-plot-y-tick-label"
                     ng-style="{ top: (100 * (max - tick.value) / interval) + '%' }"
                     title="{{:: tick.fullText || tick.text }}"
                     style="margin-top: -0.50em; direction: ltr;">
                    <span>{{:: tick.text}}</span>
                </div>
            </mct-ticks>
        </div>
        <div class="gl-plot-wrapper-display-area-and-x-axis"
             ng-style="{
                     left: (tickWidth + 30) + 'px'
                 }">
            <span class="t-object-alert t-alert-unsynced" title="This plot is not currently displaying the latest data. Reset Pan/zoom to return to view latest data."></span>
            <div class="gl-plot-display-area">
                <mct-ticks axis="xAxis">
                    <div class="gl-plot-hash hash-v"
                         ng-repeat="tick in ticks track by tick.value"
                         ng-style="{
                             right: (100 * (max - tick.value) / interval) + '%',
                             height: '100%'
                         }">
                     </div>
                </mct-ticks>


                <mct-ticks axis="yAxis">
                     <div class="gl-plot-hash hash-h"
                          ng-repeat="tick in ticks track by tick.value"
                          ng-style="{ bottom: (100 * (tick.value - min) / interval) + '%', width: '100%' }">
                     </div>
                </mct-ticks>


                <mct-chart config="config"
                           series="series"
                           rectangles="rectangles"
                           highlights="highlights"
                           the-x-axis="xAxis"
                           the-y-axis="yAxis">
                </mct-chart>

                <div class="l-local-controls gl-plot-local-controls"
                     ng-show="plotHistory.length"
                     style="position: absolute; top: 8px; right: 8px;">

                    <a class="s-button icon-arrow-left"
                       ng-click="plot.back()"
                       title="Restore previous pan/zoom">
                    </a>

                    <a class="s-button icon-arrows-out"
                       ng-click="plot.clear()"
                       title="Reset pan/zoom">
                    </a>

                </div>

                <span class="t-wait-spinner loading" ng-show="plot.isRequestPending()">
                </span>

            </div>

            <div class="gl-plot-axis-area gl-plot-x"
                 ng-style="{
                     left: (tickWidth - 30) + 'px'
                 }">

                <mct-ticks axis="xAxis">
                     <div ng-repeat="tick in ticks track by tick.text"
                          class="gl-plot-tick gl-plot-x-tick-label"
                          ng-style="{
                              left: (100 * (tick.value - min) / interval) + '%'
                          }"
                          ng-title=":: tick.fullText || tick.text">
                         {{:: tick.text | reverse}}
                     </div>
                </mct-ticks>

                <div class="gl-plot-label gl-plot-x-label">
                    {{ xAxis.get('label') }}
                </div>
            </div>

        </div>
    </div>

</div>
